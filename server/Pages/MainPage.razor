@page "/"
@layout MainLayout
@inherits MisterM.Pages.MainPageComponent

@using Radzen
@using Radzen.Blazor
@using MisterM.Models.MsMisterM
@using MisterM.Controllers
@using Microsoft.AspNetCore.SignalR
@using MisterM.Hubs
<RadzenContent Container="main">
  <ChildContent>
    <RadzenLabel style="height: 42px; width: 229.40625px">
    </RadzenLabel>
    <RadzenHeading Size="H1" style="height: 76px" Text="Mister Monitor">
    </RadzenHeading>
    <RadzenLabel style="border-radius: 10px; font-size: 21px; height: 55px; text-align: right; width: 860.390625px" Text="Welcome to the best computer monitoring software solution! Get real-time updates and enjoy! ">
    </RadzenLabel>
    <div style="display: flex; flex-wrap: wrap; justify-items: stretch; justify-content: space-evenly">
        <RadzenCard style="background-color: #e6ecef; margin-bottom: 16px;">
          <ChildContent>
            <div class="row" style="flex-wrap: nowrap">
                <RadzenIcon Icon="devices" style="height: 64px; width: 64px">
                </RadzenIcon>
              <div class="col-6" >
                <RadzenHeading Size="H4" style="margin-bottom: 0px; text-align: center" Text="Total devices">
                </RadzenHeading>
                <RadzenHeading Size="H4" style="border-radius: ; color: #cb6992; font-weight: bold; margin-bottom: 0px; text-align: center" Text="@TotalDevices.ToString()">
                </RadzenHeading>
              </div>
            </div>
          </ChildContent>
        </RadzenCard>
        <RadzenCard style="background-color: #e6ecef; margin-bottom: 16px">
          <ChildContent>
            <div class="row" style="flex-wrap: nowrap">
                <RadzenIcon Icon="track_changes" style="height: 64px; width: 64px">
                </RadzenIcon>
              <div class="col-6" >
                <RadzenHeading Size="H4" style="margin-bottom: 0px; text-align: center" Text="Active now">
                </RadzenHeading>
                <RadzenHeading Size="H4" style="border-radius: ; color: #cb6992; font-weight: bold; margin-bottom: 0px; text-align: center" Text="@ActiveDevices.ToString()">
                </RadzenHeading>
              </div>
            </div>
          </ChildContent>
        </RadzenCard>
        <RadzenCard style="background-color: #e6ecef; margin-bottom: 16px">
          <ChildContent>
            <div class="row" style="flex-wrap: nowrap">
                <RadzenIcon Icon="ac_unit" style="height: 64px; width: 64px">
                </RadzenIcon>
              <div class="col-6" >
                <RadzenHeading Size="H4" style="margin-bottom: 0px; text-align: center" Text="Average °C">
                </RadzenHeading>
                <RadzenHeading Size="H4" style="border-radius: ; color: #cb6992; font-weight: bold; margin-bottom: 0px; text-align: center" Text="0">
                </RadzenHeading>
              </div>
            </div>
          </ChildContent>
        </RadzenCard>
    </div>
    <RadzenFieldset AllowCollapse="false" style="height: 296.140625px; margin-left: 10px; width: 100%" Text="Last active devices" >
      <ChildContent>
        <RadzenDataGrid @ref="datagrid0" AllowFiltering="true" AllowPaging="true" AllowSorting="true" Data="@getComputersResult" TItem="MisterM.Models.MsMisterM.Computer" PageSize="10">
          <Columns>
            <RadzenDataGridColumn TItem="MisterM.Models.MsMisterM.Computer" Property="mac" Title="Status">
              <Template Context="computer">
                <StatusIcon IsOnline="IsComputerOnline(computer.mac)"></StatusIcon>
              </Template>
            </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="MisterM.Models.MsMisterM.Computer" Property="mac" Title="Mac">
            </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="MisterM.Models.MsMisterM.Computer" Property="name" Title="Name">
            </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="MisterM.Models.MsMisterM.Computer" Property="model" Title="Model">
            </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="MisterM.Models.MsMisterM.Computer" Property="temperature" Title="Temperature">
            </RadzenDataGridColumn>
          </Columns>
        </RadzenDataGrid>
      </ChildContent>
    </RadzenFieldset>
  </ChildContent>
</RadzenContent>

@code
{
  protected override async Task OnInitializedAsync()
  {
    TotalDevices = await ComputerController.GetComputerCount();
    ActiveDevices = ComputerController.GetConnectedDeviceCount();

    ComputerController.ComputerChanged += UpdateComputer;
    ComputerController.ComputerAdded += AddComputer;
    DeviceReadingHub.ClientCountChanged += UpdateConnectedClients;
    
    await base.OnInitializedAsync();
  }
}
